{% extends "base.html" %}

{% block title %}üçΩÔ∏è Find Your Perfect Restaurant - Quiz{% endblock %}

{% block content %}
<!-- Hero -->
<section class="quiz-hero" style="background: linear-gradient(135deg, #d32323 0%, #ff6b6b 100%); color: white; padding: 80px 0; text-align: center;">
    <div class="container">
        <h1 class="display-4 fw-bold mb-3">üçΩÔ∏è Find Your Perfect Restaurant</h1>
        <p class="lead">Answer a few questions to get personalized recommendations</p>
    </div>
</section>

<!-- Quiz Form -->
<section style="position: relative; z-index: 10;">
    <div class="container">
        <div class="quiz-card" style="background: white; border-radius: 20px; padding: 40px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); margin-top: -40px;">
            <form id="quizForm">
                <!-- Progress -->
                <div class="progress-bar" style="height: 8px; border-radius: 4px; background: #e9ecef; margin-bottom: 30px;">
                    <div class="progress-fill" id="progressFill" style="height: 100%; background: linear-gradient(90deg, #d32323, #ff6b6b); border-radius: 4px; width: 16.66%;"></div>
                </div>
                
                <!-- Question 1: Mood -->
                <div class="question active" data-step="1">
                    <h4 class="mb-4">1. What's your mood today?</h4>
                    <div class="row g-3">
                        <div class="col-6">
                            <button type="button" class="btn btn-outline-secondary w-100 p-4" onclick="selectOption('mood', 'adventurous')">
                                <span style="font-size: 2rem;">üå∂Ô∏è</span>
                                <div class="mt-2">Adventurous</div>
                            </button>
                        </div>
                        <div class="col-6">
                            <button type="button" class="btn btn-outline-secondary w-100 p-4" onclick="selectOption('mood', 'comfort')">
                                <span style="font-size: 2rem;">üçú</span>
                                <div class="mt-2">Comfort Food</div>
                            </button>
                        </div>
                        <div class="col-6">
                            <button type="button" class="btn btn-outline-secondary w-100 p-4" onclick="selectOption('mood', 'romantic')">
                                <span style="font-size: 2rem;">üíï</span>
                                <div class="mt-2">Romantic</div>
                            </button>
                        </div>
                        <div class="col-6">
                            <button type="button" class="btn btn-outline-secondary w-100 p-4" onclick="selectOption('mood', 'quick')">
                                <span style="font-size: 2rem;">‚ö°</span>
                                <div class="mt-2">Quick Bite</div>
                            </button>
                        </div>
                    </div>
                    <input type="hidden" name="mood" id="mood">
                </div>
                
                <!-- Question 2: Budget -->
                <div class="question" data-step="2">
                    <h4 class="mb-4">2. What's your budget?</h4>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <button type="button" class="btn btn-outline-secondary w-100 p-4" onclick="selectOption('budget', 'budget')">
                                <span style="font-size: 2rem;">üí∞</span>
                                <div class="mt-2">Budget<br><small>Under ‚Ç±300</small></div>
                            </button>
                        </div>
                        <div class="col-md-4">
                            <button type="button" class="btn btn-outline-secondary w-100 p-4" onclick="selectOption('budget', 'moderate')">
                                <span style="font-size: 2rem;">üíµ</span>
                                <div class="mt-2">Moderate<br><small>‚Ç±300-‚Ç±800</small></div>
                            </button>
                        </div>
                        <div class="col-md-4">
                            <button type="button" class="btn btn-outline-secondary w-100 p-4" onclick="selectOption('budget', 'splurge')">
                                <span style="font-size: 2rem;">üíé</span>
                                <div class="mt-2">Splurge<br><small>‚Ç±800+</small></div>
                            </button>
                        </div>
                    </div>
                    <input type="hidden" name="budget" id="budget">
                </div>
                
                <!-- Question 3: Cuisine -->
                <div class="question" data-step="3">
                    <h4 class="mb-4">3. What cuisine sounds good?</h4>
                    <div class="row g-3">
                        {% for c in all_cuisines[:6] %}
                        <div class="col-4">
                            <button type="button" class="btn btn-outline-secondary w-100 p-3" onclick="selectOption('cuisine', '{{ c }}')">
                                <div>{{ c }}</div>
                            </button>
                        </div>
                        {% endfor %}
                    </div>
                    <input type="hidden" name="cuisine" id="cuisine">
                </div>
                
                <!-- Question 4: Company -->
                <div class="question" data-step="4">
                    <h4 class="mb-4">4. Who are you dining with?</h4>
                    <div class="row g-3">
                        <div class="col-6">
                            <button type="button" class="btn btn-outline-secondary w-100 p-4" onclick="selectOption('company', 'date')">
                                <span style="font-size: 2rem;">üíë</span>
                                <div class="mt-2">Date Night</div>
                            </button>
                        </div>
                        <div class="col-6">
                            <button type="button" class="btn btn-outline-secondary w-100 p-4" onclick="selectOption('company', 'family')">
                                <span style="font-size: 2rem;">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>
                                <div class="mt-2">Family</div>
                            </button>
                        </div>
                        <div class="col-6">
                            <button type="button" class="btn btn-outline-secondary w-100 p-4" onclick="selectOption('company', 'friends')">
                                <span style="font-size: 2rem;">üëØ</span>
                                <div class="mt-2">Friends</div>
                            </button>
                        </div>
                        <div class="col-6">
                            <button type="button" class="btn btn-outline-secondary w-100 p-4" onclick="selectOption('company', 'solo')">
                                <span style="font-size: 2rem;">üßë</span>
                                <div class="mt-2">Solo</div>
                            </button>
                        </div>
                    </div>
                    <input type="hidden" name="company" id="company">
                </div>
                
                <!-- Question 5: Vibe -->
                <div class="question" data-step="5">
                    <h4 class="mb-4">5. What vibe do you want?</h4>
                    <div class="row g-3">
                        <div class="col-4">
                            <button type="button" class="btn btn-outline-secondary w-100 p-4" onclick="selectOption('vibe', 'casual')">
                                <span style="font-size: 2rem;">ü™ë</span>
                                <div class="mt-2">Casual</div>
                            </button>
                        </div>
                        <div class="col-4">
                            <button type="button" class="btn btn-outline-secondary w-100 p-4" onclick="selectOption('vibe', 'trendy')">
                                <span style="font-size: 2rem;">‚ú®</span>
                                <div class="mt-2">Trendy</div>
                            </button>
                        </div>
                        <div class="col-4">
                            <button type="button" class="btn btn-outline-secondary w-100 p-4" onclick="selectOption('vibe', 'cozy')">
                                <span style="font-size: 2rem;">üè†</span>
                                <div class="mt-2">Cozy</div>
                            </button>
                        </div>
                    </div>
                    <input type="hidden" name="vibe" id="vibe">
                </div>
                
                <!-- Question 6: Area -->
                <div class="question" data-step="6">
                    <h4 class="mb-4">6. Where in Quezon City?</h4>
                    <div class="row g-3">
                        {% for a in areas[:6] %}
                        <div class="col-4">
                            <button type="button" class="btn btn-outline-secondary w-100 p-3" onclick="selectOption('area', '{{ a }}')">
                                <div>{{ a }}</div>
                            </button>
                        </div>
                        {% endfor %}
                    </div>
                    <input type="hidden" name="area" id="area">
                </div>
                
                <!-- Navigation -->
                <div class="d-flex justify-content-between mt-4">
                    <button type="button" id="prevBtn" class="btn btn-outline-secondary" onclick="prevQuestion()" style="display: none;">‚Üê Back</button>
                    <button type="button" id="nextBtn" class="btn btn-primary ms-auto" onclick="nextQuestion()" style="background: #d32323; display: none;">Next ‚Üí</button>
                    <button type="button" id="submitBtn" class="btn btn-primary ms-auto" onclick="showResults()" style="background: #d32323; display: none;">See My Results ‚Üí</button>
                </div>
            </form>
        </div>
    </div>
</section>

<!-- Results -->
<section class="py-5" id="results" style="display: none;">
    <div class="container">
        <h2 class="text-center mb-5">üçΩÔ∏è Your Perfect Restaurant Match</h2>
        <div id="resultsContent"></div>
    </div>
</section>

<script>
let currentStep = 1;
const totalSteps = 6;
const answers = {};

function selectOption(field, value) {
    document.getElementById(field).value = value;
    answers[field] = value;
    
    // Visual feedback
    const btns = event.target.closest('.row').querySelectorAll('button');
    btns.forEach(btn => {
        btn.classList.remove('btn-primary');
        btn.classList.add('btn-outline-secondary');
    });
    event.target.closest('button').classList.remove('btn-outline-secondary');
    event.target.closest('button').classList.add('btn-primary');
    event.target.closest('button').style.background = '#d32323';
    event.target.closest('button').style.color = 'white';
    event.target.closest('button').style.borderColor = '#d32323';
    
    setTimeout(() => {
        nextQuestion();
    }, 300);
}

function showQuestion(step) {
    document.querySelectorAll('.question').forEach(q => q.classList.remove('active'));
    document.querySelector(`[data-step="${step}"]`).classList.add('active');
    
    // Update progress
    document.getElementById('progressFill').style.width = (step / totalSteps * 100) + '%';
    
    // Navigation buttons
    document.getElementById('prevBtn').style.display = step > 1 ? 'block' : 'none';
    
    if (step < totalSteps) {
        document.getElementById('nextBtn').style.display = 'block';
        document.getElementById('submitBtn').style.display = 'none';
    } else {
        document.getElementById('nextBtn').style.display = 'none';
        document.getElementById('submitBtn').style.display = 'block';
    }
}

function nextQuestion() {
    if (currentStep < totalSteps) {
        currentStep++;
        showQuestion(currentStep);
    }
}

function prevQuestion() {
    if (currentStep > 1) {
        currentStep--;
        showQuestion(currentStep);
    }
}

function showResults() {
    const form = document.getElementById('quizForm');
    const params = new URLSearchParams(new FormData(form)).toString();
    window.location.href = '/quiz/results?' + params;
}
</script>
{% endblock %}
